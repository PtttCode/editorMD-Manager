<link rel="stylesheet" href="editor.md/css/editormd.min.css" />
<link rel="stylesheet" href="css/jquery-custom.min.css" />
<div id="editor">
    <!-- Tips: Editor.md can auto append a `<textarea>` tag -->
    <textarea style="display:none;">### Hello Editor.md !</textarea>
    <div class="alert"></div>
</div>
<script src="js/jquery-custom.min.js"></script>
<script src="jquery.min.js"></script>
<script src="editor.md/editormd.min.js"></script>
<script type="text/javascript">
    $(function() {
        var editor = editormd("editor", {
            emoji: true,
            theme: "dark",
            // width: "100%",
            // height: "100%",
            // markdown: "xxxx",     // dynamic set Markdown text
            path : "editor.md/lib/",  // Autoload modules mode, codemirror, marked... dependents libs path
            toolbarIcons : function() {
                // Or return editormd.toolbarModes[name]; // full, simple, mini
                // Using "||" set icons align right.
                return ["undo", "redo", "|", "bold", "del", "italic", "quote", "ucwords", "uppercase", "lowercase", "|", "h1", "h2", "h3", "h4", "h5", "h6", "|", 
                "list-ul", "list-ol", "hr", "|", "link", "reference-link", "image", "code", "preformatted-text", "code-block", "table", "datetime", "emoji", "html-entities", 
                "pagebreak", "|", "goto-line", "watch", "preview", "fullscreen", "clear", "search", "|", "help", "info", "save"]
            },
            // toolbarIcons : "full", // You can also use editormd.toolbarModes[name] default list, values: full, simple, mini.
            toolbarIconsClass : {
                save : "fa-save"  // 指定一个FontAawsome的图标类
            },
            // toolbarIconTexts : {
            //     testIcon : "Save"  // 如果没有图标，则可以这样直接插入内容，可以是字符串或HTML标签
            // },

            // 自定义工具栏按钮的事件处理
            toolbarHandlers : {
                /**
                 * @param {Object}      cm         CodeMirror对象
                 * @param {Object}      icon       图标按钮jQuery元素对象
                 * @param {Object}      cursor     CodeMirror的光标对象，可获取光标所在行和位置
                 * @param {String}      selection  编辑器选中的文本
                 */
                save : function(cm, icon, cursor, selection) {
                    
                    //var cursor    = cm.getCursor();     //获取当前光标对象，同cursor参数
                    //var selection = cm.getSelection();  //获取当前选中的文本，同selection参数
                    
                    // 替换选中文本，如果没有选中文本，则直接插入
                    // cm.replaceSelection("[" + selection + ":testIcon]");
                    
                    // // 如果当前没有选中的文本，将光标移到要输入的位置
                    // if(selection === "") {
                    //     cm.setCursor(cursor.line, cursor.ch + 1);
                    // }
                    
                    // this == 当前editormd实例
                    $.ajaxSetup({contentType: "application/json; charset=utf-8"});
                    data = JSON.stringify({'authorName':"pt", 'filename':"golang-knowledge", "content": editor.getMarkdown()})
                    $.post("/savemd", data, function(data, status){
                        console.log(data, status, data.Code)
                        if (data.Code == 0){
                            successTip(data.Msg, 1500)
                        }else{
                            dangerTip(data.Msg, 1500)
                        }
                    });
                },
            },
            
            lang : {
                toolbar : {
                    save : "保存",  // 自定义按钮的提示文本，即title属性
                }
            },
        });
    });
</script>